if (! whatis ok_diff_script >/dev/null >[2=1]) {
    echo 'You must load $GS_SPEC/bin/test-fns before loading $GS_SPEC/bin/gs-spec' >[1=2]
    exit 1
}
if not true

fn test_non_existent_file {
    ok_grep_errors '-- non-existent source file --' 'no-such-file.gs: Could not load' test_gsi_impl no-such-file.gs
}

fn test_empty_file {
    TEST_DIR=$GS_SPEC ok_grep_errors '-- empty source file --' 'empty-file.gs:1:1: Undefined' test_gsi_impl empty-file.gs
}

fn test_unbound_file {
    TEST_DIR=$GS_SPEC ok_grep_errors '-- variable not in scope --' 'foo not in scope' test_gsi_impl unbound-variable.gs
}

fn test_function_variable {
    TEST_DIR=$GS_SPEC ok_diff '-- function variable --' test_gsi_impl bare-gsmain.gsi.gs
}

fn test_undefined_variable {
    TEST_DIR=$GS_SPEC ok_grep_errors '-- undefined variable --' 'undefined.gs:1:1: Undefined' test_gsi_impl undefined.gs
}
